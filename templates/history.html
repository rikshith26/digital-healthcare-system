{% extends "layout.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo" style="margin-bottom: 2rem;">HealthLab <span style="font-weight: 300;">AI</span></div>
        <a href="{{ url_for('dashboard') }}" class="sidebar-item">
            <i data-lucide="layout-grid"></i> Dashboard
        </a>
        <a href="{{ url_for('profile') }}" class="sidebar-item">
            <i data-lucide="user"></i> My Profile
        </a>
        <a href="{{ url_for('history') }}" class="sidebar-item active">
            <i data-lucide="history"></i> Medical History
        </a>
        <a href="{{ url_for('book_test_page') }}" class="sidebar-item">
            <i data-lucide="microscope"></i> Book a Test
        </a>
        <a href="#" class="sidebar-item">
            <i data-lucide="settings"></i> Settings
        </a>
        <a href="#" class="sidebar-item">
            <i data-lucide="message-square"></i> Feedback
        </a>
        <a href="{{ url_for('logout') }}" class="sidebar-item" style="color: var(--accent);">
            <i data-lucide="log-out"></i> Sign Out
        </a>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header style="margin-bottom: 2rem;">
            <h1 style="font-size: 2rem; margin: 0;">Medical History</h1>
            <p style="color: var(--text-muted);">View all your previous bookings and diagnostic reports.</p>
        </header>

        <div class="grid-2">
            <!-- Test Bookings History -->
            <div class="frosted-card">
                <h3 style="margin-top: 0; display: flex; align-items: center; gap: 0.5rem;">
                    <i data-lucide="calendar" style="color: var(--primary);"></i> Past Bookings
                </h3>
                <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem;">
                    {% if bookings %}
                    {% for booking in bookings %}
                    <div
                        style="background: var(--bg-main); padding: 1.25rem; border-radius: 20px; border: 1px solid var(--border-light);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h4 style="margin: 0;">{{ booking.test_name }}</h4>
                            <div
                                style="padding: 0.2rem 0.6rem; border-radius: 10px; background: rgba(79, 70, 229, 0.1); color: var(--primary); font-size: 0.7rem; font-weight: 700;">
                                {{ booking.status.upper() }}
                            </div>
                        </div>
                        <small style="color: var(--text-muted);">{{ booking.date }} at {{ booking.time }}</small>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p style="color: var(--text-muted); text-align: center; padding: 2rem;">No previous bookings found.
                    </p>
                    {% endif %}
                </div>
            </div>

            <!-- Diagnostics Reports History -->
            <div class="frosted-card">
                <h3 style="margin-top: 0; display: flex; align-items: center; gap: 0.5rem;">
                    <i data-lucide="file-text" style="color: var(--secondary);"></i> Clinical Reports
                </h3>
                <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem;">
                    {% if reports %}
                    {% for report in reports %}
                    <div
                        style="background: var(--bg-main); padding: 1.5rem; border-radius: 20px; border: 1px solid var(--border-light);">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-weight: 700; color: var(--text-main);">Laboratory Result</span>
                            <small style="color: var(--text-muted);">{{ report.timestamp }}</small>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-main); margin: 0.75rem 0; line-height: 1.5;">
                            {{ report.get('description', 'Medical analysis summary...')[:120] }}...
                        </p>
                        <a href="{{ url_for('download_report', filename=report.pdf_url) }}" class="btn-modern"
                            style="display: inline-block; text-decoration: none; font-size: 0.8rem; padding: 0.5rem 1.25rem;">
                            Download PDF
                        </a>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p style="color: var(--text-muted); text-align: center; padding: 2rem;">No diagnostic reports
                        available yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>

</div>
{% endblock %}